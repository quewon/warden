<!DOCTYPE html>
<html>
<head>
	<title>warden</title>
	<style>
		:root {
			--gui: #6c8078;
			--bg: black;
			--cargo: #755b2e;
			--border: 3px dashed var(--gui);

			background-color: var(--bg);
			color: white;
			font-family: monospace;
		}
		canvas {
			width: 240px;
			height: 240px;
			background-color: transparent;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
		}

		#map {
			background-color: var(--bg);
			width: 240px;
			height: 240px;
			border: var(--border);
			-webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
			-moz-box-sizing: border-box;    /* Firefox, other Gecko */
			box-sizing: border-box;         /* Opera/IE 8+ */
			visibility: hidden;
		}

		#info_bg {
			margin-top: 10px;
			text-align: center;
			-webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
			-moz-box-sizing: border-box;    /* Firefox, other Gecko */
			box-sizing: border-box;         /* Opera/IE 8+ */
		}
	</style>
</head>

<body>
	<canvas width="480" height="480"></canvas><canvas id="map" width="480" height="480"></canvas>
	<div id="info_bg"><span id="info">[WASD] TO MOVE<br />[SPACE] TO INTERACT & DRAG</span></div>
</body>

<script>
	var style = getComputedStyle(document.body);
	var canvas = document.querySelector("canvas");
	var width = canvas.width; height = canvas.height;
	var c = canvas.getContext('2d');
	var mapc = document.getElementById("map").getContext('2d');
	var info = document.getElementById("info");

	var cellsize = Math.round(width/8);

	function animate() {
		requestAnimationFrame(animate);
		c.clearRect(0, 0, width, height);

		drawRoom(mob.player.room);
		drawMobs();

		//UI
		mapc.clearRect(0, 0, width, height);
		drawMap();
	}

	var keyfired = false;
	var key_interacting = false;
	var key_dragging = false;
	//TODO: add speed cap to player
	function key(event) {
		event = event || window.event;
		let key = event.key || event.which || event.keyCode;

		if (key=='w') { move(0) }
		else if (key=='a') { move(1) }
		else if (key=='s') { move(2) }
		else if (key=='d') { move(3) }

		if (key==' ') {
			key_interacting = true;
		}
	}

	function keyup(event) {
		event = event || window.event;
		let key = event.key || event.which || event.keyCode;

		if (key==' ') { //spacebar; interact
			let imobs = shuffle(surroundingMobs('player'));
			if (imobs.length>0 && !key_dragging) { interactMob(imobs[0]); }

			key_interacting = false;
			key_dragging = false;
		}
	}
</script>
<script src="mob.js"></script>
<script src="room.js"></script>
<script>
	mapGen();

	window.onkeydown = key;
	window.onkeyup = keyup;

	animate();
</script>

</html>